<style>
	.game-ui {
   		background-color: rgba(0, 245, 245, 0.6);
   		border-color: rgb(0, 245, 245);
	}

	a.game-ui {
   		background-color: rgba(0, 0, 0, 0);
	}

</style>


<script type="text/paperscript" canvas="canvas">
	var linkWidth = 3;
	var starRingRadius = 15;

	function vector2(x, y) {
		return {x:x, y:y};
	}

	function diffVector2(v1, v0) {
		var x = v1.x - v0.x;
		var y = v1.y - v0.y;
		return vector2(x, y);
	}

	function sumVector2(v1, v0) {
		var x = v1.x + v0.x;
		var y = v1.y + v0.y;
		return vector2(x, y);
	}

	function multVector2(m, v) {
		var x = m * v.x;
		var y = m * v.y;
		return vector2(x, y);
	}

	function lengthVector2(v) {
		var lengthSquared = v.x*v.x + v.y*v.y;
		return Math.sqrt(lengthSquared);
	}

	function normalizeVector2(v) {
		var length = lengthVector2(v);
		var x = v.x / length;
		var y = v.y / length;
		return vector2(x, y);
	}

	function getPoints(posA, posB) {

		var dirV = normalizeVector2( diffVector2(posA, posB) );
		var multiplier = starRingRadius;
	
		var points = [];
		points.push( diffVector2(posA, multVector2(multiplier, dirV)) );
		points.push( sumVector2(posB, multVector2(multiplier, dirV)) );
		return points;
	}

	function addStar(starData, useImage) {
		var star = null;
		if (useImage) {
			star = new Path.Raster('Sun');/*{
				image: 'Sun',
		        center: new Point(data.pos.x, data.pos.y),
		        radius: data.type.radius
		    });*/

		    star.onLoad = function() {
	            console.log('Successfully loaded image!');
	        };
		}
		else {
			star = new Path.Circle({
		        center: new Point(data.pos.x, data.pos.y),
		        radius: data.type.radius,
		        fillColor: data.type.color,
		        strokeColor: data.type.color
		    });
		}
		return star;
	}

	var map = <%- JSON.stringify(map) %>;

	var stars = [];
	var links = [];
	var linkRings = [];

	for (var i in map.links) {
		var starA_id = map.links[i][0];
		var starB_id = map.links[i][1];
		var starA = map.stars[starA_id-1];
		var starB = map.stars[starB_id-1];

		var points = getPoints(starA.pos, starB.pos);

		var link = new Path.Line({
		    from: [points[0].x, points[0].y],
		    to: [points[1].x, points[1].y],
		    strokeColor: 'cyan',
		    strokeWidth: linkWidth
		});

		links.push(link);
	}

	for (var i in map.stars) {
		var data = map.stars[i];
		var star = addStar(data, false);

	    stars.push(star);

	    var ring = new Path.Circle({
	        center: new Point(data.pos.x, data.pos.y),
	        radius: starRingRadius,
	        strokeColor: 'cyan',
	        strokeWidth: linkWidth
	    });

	    linkRings.push(ring);
	}

    function onMouseMove(event) {
        //mouseVector = view.center - event.point;
    }

    // The onFrame function is called up to 60 times a second:
    function onFrame(event) {
        //vector = vector + (mouseVector - vector) / 30;

        // Run through the active layer's children list and change
        // the position of the placed symbols:
        /*for (var i = 0; i < count; i++) {
            var item = project.activeLayer.children[i];
            var size = item.bounds.size;
            var length = vector.length / 10 * size.width / 10;
            item.position += vector.normalize(length) + item.data.vector;
            keepInView(item);
        }*/
    }

    /*function keepInView(item) {
        var position = item.position;
        var itemBounds = item.bounds;
        var bounds = view.bounds;
        if (itemBounds.left > bounds.width) {
            position.x = -item.bounds.width;
        }

        if (position.x < -itemBounds.width) {
            position.x = bounds.width + itemBounds.width;
        }

        if (itemBounds.top > view.size.height) {
            position.y = -itemBounds.height;
        }

        if (position.y < -itemBounds.height) {
            position.y = bounds.height  + itemBounds.height / 2;
        }
    }*/
</script>

<script>
	function hasClass(element, cls) {
    	return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
	}

	function getFirstParentElement(obj, parentClassName) {
		var wellBaseMultiplier = 1.0;

		var parent = obj;
		var foundParent = null;
		while(!parent)
		{
			if (parent.parentElement == null) {
				break;
			}

			if (hasClass(parent, parentClassName)) {
				foundParent = parent;
			}
			else {
				parent = parent.parentElement;
			}
		}
		
		return foundParent;
	}


	function resizeCanvas(canvas){
		if (!canvas) {
			return;
		}

        var canvasPanel = document.getElementById("canvas-container");

		var targetHeight = window.innerHeight * canvas.getAttribute('rheight');
		var targetWidth = canvasPanel.clientWidth - 30;

		if (canvas.getAttribute('rwidth') != null) {
			targetWidth = window.innerHeight * canvas.getAttribute('rwidth');
		}

        if (canvas.width != targetWidth)
        {
            canvas.width = targetWidth;
        }

        if (canvas.height != targetHeight)
        {
            canvas.height = targetHeight;
        }
    }

    function resizeAllCanvas(){
    	var canvasArray = document.getElementsByTagName("canvas");

		for (var i=0; i < canvasArray.length; i++) {
		     resizeCanvas( canvasArray[i] );
		}
	}

    $(document).ready(function() {
    	window.addEventListener('resize', resizeAllCanvas, false);
        resizeAllCanvas();
	});
</script>

<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-10">
		<div class="panel panel-primary game-ui" id="canvas-container">
			<div class="panel-heading">
				<h4 class="panel-title">
					<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" class="game-ui">
						<span class="badge alert-info"><span class="glyphicon glyphicon-usd"></span> 4000</span>
					</a>
				</h4>
		    </div>
		    <div id="collapseOne" class="panel-collapse collapse">
				<div class="panel-body">
					<canvas id="canvas" class="star-map-bg" rheight=0.6 keepalive="true"></canvas>
					<div class="row">
						<div class="col-md-2"></div>
						<div class="col-md-8">
							<div class="btn-group">
								<a class="btn btn-primary active" href="#fakelink"><span class="fui-star-2"></span> Map</a>
								<a class="btn btn-primary" href="#fakelink"><span class="fui-export"></span> Hanger</a>
								<a class="btn btn-primary" href="#fakelink"><span class="fui-link"></span> Trade</a>
								<a class="btn btn-primary" href="#fakelink"><span class="fui-eye"></span> Intel</a>
								<a class="btn btn-primary" href="#fakelink"><span class="fui-mic"></span> Comms</a>
							</div>
						</div>
						<div class="col-md-2"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-1"></div>
</div>

<!--
<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-3 well game-ui">
		<div class="row">
			<div class="col-md-12"><a class="btn btn-primary btn-block btn-lg active" href="#fakelink">Alpha</a><br></div>
		</div>
		<div class="row">
			<div class="col-md-12"><a class="btn btn-primary btn-block btn-lg" href="#fakelink">Bravo</a><br></div>
		</div>
		<div class="row">
			<div class="col-md-12"><a class="btn btn-primary btn-block btn-lg" href="#fakelink">Charlie</a></div>
		</div>
	</div>
	<div class="col-md-4"></div>
	<div class="col-md-3 well game-ui">
		<div class="panel panel-default">
	  		<div class="panel-heading">Panel heading without title</div>
	  		<div class="panel-body">
	    		Panel content
	  		</div>
		</div>
	</div>
</div>
-->

<script>
	var el = document.getElementById('draggableElement');
	var leftEdge = el.parentNode.clientWidth - el.clientWidth;
	var topEdge = el.parentNode.clientHeight - el.clientHeight;
	var dragObj = new dragObject(el, null, new Position(leftEdge, topEdge), new Position(0, 0));
</script>

<div id="hiddenAssets" style="display: none;">
	<img id="Sun" src="/game/starmap/Sun.png"/>
	<img src="/game/starmap/Mercury.png"/>
	<img src="/game/starmap/Venus.png"/>
	<img src="/game/starmap/Earth.png"/>
	<img src="/game/starmap/Mars.png"/>
	<img src="/game/starmap/Jupiter.png"/>
	<img src="/game/starmap/Saturn.png"/>
	<img src="/game/starmap/Uranus.png"/>
	<img src="/game/starmap/Neptune.png"/>
	<img src="/game/starmap/Pluto.png"/>
</div>